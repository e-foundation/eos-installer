<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1.0, user-scalable=0" />
    <link rel="stylesheet" href="css/styles.css" />
    <title>/e/Os web installer</title>
    <script src="js/lib/mustache/mustache.min.js"></script>
    <script src="js/lib/zip/zip-no-worker-inflate.min.js"></script>
    <script src="js/lib/webadb/webadb.js"></script>

    <script src="js/log.class.js"></script>
    <script src="js/vue.class.js"></script>
</head>
<body lang="en" id="body">
    <header>
        <h1 id="main-title">/e/Os web installer</h1>
    </header>
    <section id="process">
        <h1>Requirements</h1>
        <ul>
            <li>If required take a backup of all important data from your phone on an external storage device before proceeding.</li>
            <li>Do not take a backup on the same device as some of these actions will format the device and delete the backup.</li>
            <li>Ensure your phone is charged more than 50%.</li>
            <li>Check that adb and fastboot are enabled on your PC. If not you can find the setup instructions here</li>
            <li>Download all the files and images mentioned in the download section below before starting the installation</li>
            <li>Make sure you have a working data cable to connect your device to the PC. There are cables which are only for charging and do not transfer data.
            </li>
            <li>Boot your device with the stock OS at least once and check every functionality.</li>
        </ul>
        <h1>The installation process</h1>
        <ul>
            <li>Unlocking the phone</li>
            <li>Installing E</li>
            <li>Locking the phone</li>
        </ul>


        <section id="information">
            {{#model}}
            <h2>
                <span id="model" >{{#name}}{{name}}  -  {{/name}}{{^name}}No model found{{/name}}</span>
                <span id="status" >{{#device.connected}}connected{{/device.connected}}</span>
            </h2>
            {{/model}}
            <hr>
        </section>
        <section id="steps">

            {{^step.needUser}}
            Wait for the next instruction
            {{/step.needUser}}


            {{#step.fastbootConnect}}
            Your phone is reconnecting
            {{/step.fastbootConnect}}


            {{#step.adbConnect}}
            <ul></ul>
            <li>Enable USB debugging on your device</li>
            <li>Enable OEM unlock on your device</li>
            <li><button class="connect" onclick="VUE.onConnectADB(this)">Connect your phone</button> and select your device</li>

            {{#model.name}}
            <li>Your phone {{model.name}} is connected</li>
            <li><%Your phone {{model.name}} is connected%></li>
            {{/model.name}}
            <li>Allow popup</li>


            {{#device.connected}}
            {{^model.supported}}
            <li>This device is not supported yet <button class="connect" onclick="VUE.onConnectADB(this)">Connect another phone</button></li>
            {{/model.supported}}
            {{/device.connected}}

            {{/step.adbConnect}}


            {{#step.connectBootloader}}
            <li><button class="connect" onclick="VUE.onConnectBootloader(this)">Connect your phone again</button></li>
            {{/step.connectBootloader}}

            {{#step.unlock}}
            <h1>Unlocking the phone</h1>
            <ul>

                <!-- <li><button class="unlock" onclick="VUE.onUnlock(this)">unlock your phone</button></li> -->
                <li>Select unlock the bootloader</li>
                <li>Restart the phone if needed</li>
                <li>Enable USB debugging on your device. You can find the instructions here</li>
                <li>Enable OEM unlock on your device. You can find the instructions here</li>
                <li><button class="connect" onclick="VUE.onConnectADB(this)">Connect your phone</button> and select your device</li>
            </ul>
            {{/step.unlock}}

            {{#recovery.installed}}
            {{#step.startInRecovery}}
            <h1>Installation</h1>
            <ul>
                <li>Restart in recovery</li>
                <li>Select Factory reset</li>
                <li>Select Format data / Factory reset option</li>
                <li>Next screen will display a warning that this action cannot be undone</li>
                <li>Select Format data to proceed</li>
                <li> Select Apply Update and in next screen Apply update from adb</li>
                <li><button class="restart-in-recovery" onclick="VUE.installRom(this)">install</button></li>
            </ul>
            {{/step.startInRecovery}}
            {{/recovery.installed}}
            {{#installed}}
                    {{#step.key}}
                    <h1>Installing key</h1>
                    <ul>
                        {{#recovery.installed}}
                        <li>Wait for the end of the installation. When the installation is done, you'll be able to go back in the main e screen</li>
                        <li>Select Advanced</li>
                        <li>Select Reboot to bootloader</li>
                        {{/recovery.installed}}
                        <li><button class="unlock" onclick="VUE.installKey(this)">installKey</button></li>
                    </ul>
                    {{/step.key}}
                    {{^step.key}}
                        {{#step.lock}}
                        <h1>Locking the phone</h1>
                        <ul>
                            <li><button class="lock" onclick="VUE.onLock(this)">lock your phone</button></li>
                            <li>Restart the phone if needed</li>
                            <li><h1>The end</h1></li>
                        </ul>
                        {{/step.lock}}
                        {{^step.lock}}
                            <h1>The end</h1>
                            {{#recovery.installed}}
                            <li>Wait for the end of the installation. When the installation is done, you'll be able to go back in the main e screen</li>
                            <li>Go back to the main screen and select Reboot system now</li>
                            {{/recovery.installed}}
                        {{/step.lock}}
                    {{/step.key}}
            {{/installed}}
            <!-- <button class="skip" onclick="VUE.onSkip(this)">skip</button> -->
        </section>
    </section>
    <footer>
        <section id="log-ctn" style="background: black; height:400px;overflow:auto;">
        <pre id="log"  style="color:white;">Log _</pre>
        </section>
    </footer>
</body>
<script>
    var VUE = new VueManager();
    var exports = {};
    document.addEventListener('DOMContentLoaded', async ()=>{
        await VUE.init();
    });
</script>
</html>